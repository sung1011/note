# mq

## 选项

- kafka

- rabbitmq

- redis.stream

- rocketMq

- activeMq

## 功能

- queue
- work queues
- publish/subscribe
- routing
- topic
- RPC

## 协议

- AMQP 高级消息队列协议

## 场景

### 异步

    并行读取

```bash
# 串行
    ------------->     ------------->        ------------->
  C                写DB               发短信               发邮件
    <-------------     <-------------        <-------------
    #耗时 50                 50                      50

# 并行
    ------------->     -------------> 
  C                写DB               发邮件, 发短信
    <-------------     <-------------
    #耗时 50                 50                     

# 异步
    ------------->            <------------- 发邮件
  C                写DB --> MQ    (异步读取)
    <-------------            <------------- 发短信
    #耗时 50             1                     
```

### 解耦

    系统崩溃时保障可用性

```bash
# 耦合
  订单 -------------> 库存
    # 库存系统崩溃, 则下订单也会失败

# 解耦
  订单 -------------> MQ <------------- 库存
                                订阅接收
    # 库存系统奔溃, 依然可以下订单
```

### 流量肖峰

    高并发时排队

```bash
  C端 -------------> MQ <------------- 秒杀业务处理
                            (读取秒杀请求)
    # 若mq的长度大于库存, 则抛弃请求且跳转到错误页面

    # 日志处理 类似, 只是mq的len大一些
```

### 消息通讯

    多点订阅接收

```bash
# 点对点
  用户a -------------> MQ <------------- 用户b
          (发送)                (订阅接收)

# 聊天室
                          <------------- 用户b
  用户a -------------> MQ <------------- 用户c
                          <------------- 用户d
            (发送)              (订阅接收)
```

## ref

- 实际用法 <https://blog.csdn.net/lvwenbo0107/article/details/117423481>
- rabbitmq vs kafka <https://www.simplilearn.com/kafka-vs-rabbitmq-article>
- rabbitmq vs kafka <https://blog.csdn.net/baichoufei90/article/details/83795829>