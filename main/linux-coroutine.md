# linux 协程

    协程是一种用户态的轻量级线程, 协程的调度完全由用户控制.
    协程拥有自己的寄存器上下文和栈. 协程调度切换时, 将寄存器上下文和栈保存到其他地方, 切换时直接操作栈则基本没有内核切换的开销, 可以不加锁的访问全局变量, 所以上下文的切换非常快.

## 特性

```bash
    # 多线程问题
        - `高内存` 每个线程至少4M
        - `难切换` 线程切换需要保存状态, 涉及用户态+内核态, 所以高CUP运算和高耗时

        Thread0     |----|            |----|
                    task0             task0
        Thread1              |----|
                             task1


        线程切换的开销      |--|     |--|
                          保存用户态+内核态


    # 协程
        - `低内存` 每个协程4k
        - `易切换` 协程切换需要保存状态, 只设计用户态, 低消耗

        Thread0    |----| |----| |----|
                   task0  task1  task0

        协程切换的开销    |-|    |-|
                        仅保存用户态
```

## 场景

- `非阻塞` 协程如果调用`阻塞IO的操作`会令整个线程阻塞. 所以需要对系统IO进行封装, 改成异步IO调用.
- `非计算密集` 计算密集型的任务本身不需要大量的线程or协程切换

> `阻塞IO的方法` 打印，读取文件，Socket接口等