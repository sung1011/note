# 脑裂

## 概述

    在主备切换时, 由于切换不彻底, 导致C端和slave把数据x发给新master后, 老master恢复造成x丢失.

## 现象

```bash
m0, s1, s2, s3, a4          # 5个实例 1主3从1仲裁.  
m0 | s1, s2, s3, a4      # 由于网络等原因, m0与其他实例断开心跳, 从集群中消失.  
m0 |`s1->m1`, s2, s3, a4        # s1被选举升级为master m1.  
`m0`, m1, s2, s3, a4        # 已断开的m恢复心跳, 此时出现两个主, 即脑裂.  

m0, `m1->s1`, s2, s3, a4    # 若m1降级为s1, 则这个实例作为主时的数据会丢失.  
`m0->s0`, m1, s2, s3, a4    # 若m0降级为s0, 则无问题
```

## 解决办法

- 若可以设置优先级, 可将m, s的优先级设为一致, 保障了`m0恢复后, 不会出现m1->s1`

- 记录选举轮数,  m0是L1的选举结果, m1是L2的选举结果, 故脑裂时m0应自动降级.
